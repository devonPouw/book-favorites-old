<form [formGroup]="searchForm" (ngSubmit)="onSubmit()">
  <div style="width: 100%; display: flex; justify-content: space-between">
    <button type="button" mat-button (click)="clearForm()">Reset fields</button>
    <mat-form-field>
      <mat-label>Sort by</mat-label>
      <mat-select formControlName="sort">
        @for (option of sortOptions; track $index) {
        <mat-option [value]="option.value">{{ option.viewValue }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
  </div>
  <div class="search-fields">
    <p>
      <mat-form-field appearance="outline">
        <mat-label
          >Book title
          <mat-icon
            matTooltip="
              Will find any books with '{{ title?.value }}' in the title
            "
            matTooltipPosition="above"
            fontIcon="info"
        /></mat-label>
        <input
          formControlName="title"
          matInput
          placeholder="Lord of the Rings"
        />
        <button
          matSuffix
          type="button"
          class="clear-button"
          mat-mini-fab
          (click)="clearField('title')"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </mat-form-field>
    </p>
    <p>
      <mat-form-field appearance="outline">
        <mat-label
          >Author
          <mat-icon
            matTooltip="Will find any books written by '{{ author?.value }}'
            (multiple allowed, separated by spaces or commas)"
            matTooltipPosition="above"
            fontIcon="info"
        /></mat-label>
        <input formControlName="author" matInput placeholder="Roald Dahl" />
        <button
          matSuffix
          type="button"
          class="clear-button"
          mat-mini-fab
          (click)="clearField('author')"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </mat-form-field>
    </p>
    <p>
      <mat-form-field appearance="outline">
        <mat-label
          >ISBN
          <mat-icon
            matTooltip="
             10-digit and 13-digit ISBNs are allowed
          "
            matTooltipPosition="above"
            fontIcon="info"
        /></mat-label>
        <input
          formControlName="isbn"
          matInput
          #input
          maxlength="13"
          placeholder="1234567890"
          bfIsbnValidator
        />
        <button
          matSuffix
          type="button"
          class="clear-button"
          mat-mini-fab
          (click)="clearField('isbn')"
        >
          <mat-icon>delete</mat-icon>
        </button>
        <mat-hint
          >@if(isSearchButtonDisabled() && isbn){
          <span>ISBN is invalid</span>
          @if(isbn.value && isbn.value.length < 10) { {{ isbn.value.length }}/10
          } @else{ {{ isbn.value?.length }}/13 }}
        </mat-hint>
      </mat-form-field>
    </p>
    <p>
      <mat-form-field appearance="outline">
        <mat-label
          >Publish year
          <mat-icon
            matTooltip="
           Will find any book published in the year '{{ publishYear?.value }}'.
           For range search, use e.g '2000-2010' or '*-2010 for anything published before and up to the year 2010'
        "
            matTooltipPosition="above"
            fontIcon="info"
        /></mat-label>
        <input formControlName="publishYear" matInput placeholder="2024" />
        <button
          matSuffix
          type="button"
          class="clear-button"
          mat-mini-fab
          (click)="clearField('publishYear')"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </mat-form-field>
    </p>

    <p>
      <mat-form-field appearance="outline">
        <mat-label
          >Language
          <mat-icon
            matTooltip="
          enter the first three letters of the language; japan uses jpn; mul
          for multiple; und for undetermined
        "
            matTooltipPosition="above"
            fontIcon="info"
        /></mat-label>
        <input
          formControlName="language"
          maxlength="3"
          matInput
          placeholder="eng"
        />
        <button
          matSuffix
          type="button"
          class="clear-button"
          mat-mini-fab
          (click)="clearField('language')"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </mat-form-field>
    </p>
    <p>
      <mat-form-field appearance="outline">
        <mat-label
          >Place
          <mat-icon
            matTooltip="Will find any books about '{{ place?.value }}'
          (multiple allowed, separated by spaces or commas)"
            matTooltipPosition="above"
            fontIcon="info"
        /></mat-label>
        <input formControlName="place" matInput placeholder="Utrecht" />
        <button
          matSuffix
          type="button"
          class="clear-button"
          mat-mini-fab
          (click)="clearField('place')"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </mat-form-field>
    </p>
    <p>
      <mat-form-field appearance="outline">
        <mat-label
          >Subject
          <mat-icon
            matTooltip="Will find any books about '{{ subject?.value }}'
          (multiple allowed, separated by spaces or commas)"
            matTooltipPosition="above"
            fontIcon="info"
        /></mat-label>
        <input formControlName="subject" matInput placeholder="Fantasy" />
        <button
          matSuffix
          type="button"
          class="clear-button"
          mat-mini-fab
          (click)="clearField('subject')"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </mat-form-field>
    </p>
    <p>
      <mat-form-field appearance="outline">
        <mat-label
          >Publisher
          <mat-icon
            matTooltip=" Will find any books by a publisher with '{{
              publisher?.value
            }}' in their name"
            matTooltipPosition="above"
            fontIcon="info"
        /></mat-label>
        <input formControlName="publisher" matInput placeholder="Malmberg" />
        <button
          matSuffix
          type="button"
          class="clear-button"
          mat-mini-fab
          (click)="clearField('publisher')"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </mat-form-field>
    </p>
    <p>
      <mat-form-field appearance="outline">
        <mat-label
          >Character
          <mat-icon
            matTooltip="Will find any books with '{{ person?.value }}' in it
        (multiple allowed, separated by spaces or commas)"
            matTooltipPosition="above"
            fontIcon="info"
        /></mat-label>
        <input formControlName="person" matInput placeholder="Harry Potter" />
        <button
          matSuffix
          type="button"
          class="clear-button"
          mat-mini-fab
          (click)="clearField('person')"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </mat-form-field>
    </p>
  </div>

  <div
    style="width: fit-content"
    matTooltip="Filled fields need to be valid."
    [matTooltipDisabled]="!isSearchButtonDisabled()"
  >
    <button type="submit" mat-flat-button [disabled]="isSearchButtonDisabled()">
      Search
    </button>
  </div>
</form>

<div #listContainer>
  <h1>Books</h1>
  @if (books(); as books) {
  <ul class="book-list">
    @for (book of books.docs; track book.key) {
    <li>
      @if (!isLoading()) {
      <bf-book-list-item [book]="book"></bf-book-list-item>
      } @else {
      <bf-book-skeleton></bf-book-skeleton>
      }
    </li>
    } @empty {
    <li>No books available.</li>
    }
  </ul>
  @if (totalPages(); as totalPages;) {
  <div style="width: 100%; display: flex; justify-content: center">
    <mat-paginator
      #paginator
      class="demo-paginator"
      (page)="handlePageEvent($event)"
      [length]="books.numFound"
      [pageSize]="limit"
      [showFirstLastButtons]="true"
      [pageSizeOptions]="pageSizeOptions"
      [pageIndex]="page() - 1"
      aria-label="Select page"
    >
    </mat-paginator>
  </div>
  } } @else {
  <div class="loader">
    <mat-spinner></mat-spinner>
  </div>
  }
</div>
