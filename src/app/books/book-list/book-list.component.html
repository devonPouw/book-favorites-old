<form [formGroup]="searchForm" (ngSubmit)="onSubmit()">
  <div style="width: 100%; display: flex; justify-content: space-between">
    <button type="button" mat-button (click)="clearForm()">Reset fields</button>
    <mat-form-field>
      <mat-label>Sort by</mat-label>
      <mat-select formControlName="sort">
        @for (option of sortOptions; track $index) {
        <mat-option [value]="option.value">{{ option.viewValue }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
  </div>
  <div
    style="
      display: flex;
      flex-wrap: wrap;
      @media screen and (max-width: 700px) {
        justify-content: center;
      }
    "
  >
    <p>
      <mat-form-field appearance="outline">
        <mat-label>Book title</mat-label>
        <input
          formControlName="title"
          matInput
          placeholder="Lord of the rings"
        />
        <button
          matSuffix
          type="button"
          class="clear-button"
          mat-mini-fab
          (click)="clearField('title')"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </mat-form-field>
    </p>
    <p>
      <mat-form-field appearance="outline">
        <mat-label>Author</mat-label>
        <input formControlName="author" matInput placeholder="Roald Dahl" />
        <button
          matSuffix
          type="button"
          class="clear-button"
          mat-mini-fab
          (click)="clearField('author')"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </mat-form-field>
    </p>
    <p>
      <mat-form-field appearance="outline" hintLabel="ISBN-10 and ISBN-13">
        <mat-label>ISBN</mat-label>
        <input
          formControlName="isbn"
          matInput
          #input
          maxlength="13"
          placeholder="1234567890"
          bfIsbnValidator
        />
        <button
          matSuffix
          type="button"
          class="clear-button"
          mat-mini-fab
          (click)="clearField('isbn')"
        >
          <mat-icon>delete</mat-icon>
        </button>
        <mat-hint align="end"
          >@if(isSearchButtonDisabled() && isbn){<em>ISBN is invalid</em>
          @if(isbn.value && isbn.value.length < 10) { {{ isbn.value.length }}/10
          } @else{ {{ isbn.value?.length }}/13 }}
        </mat-hint>
      </mat-form-field>
    </p>
    <p>
      <mat-form-field appearance="outline">
        <mat-label>Year published</mat-label>
        <input formControlName="publishYear1" matInput placeholder="0" />
        <button
          matSuffix
          type="button"
          class="clear-button"
          mat-mini-fab
          (click)="clearField('publishYear1')"
        >
          <mat-icon>delete</mat-icon>
        </button>
        <mat-hint> Year published from </mat-hint>
      </mat-form-field>
    </p>
    <p>
      <mat-form-field appearance="outline">
        <mat-label>Year published</mat-label>
        <input formControlName="publishYear2" matInput placeholder="2024" />
        <button
          matSuffix
          type="button"
          [disabled]="searchForm.get('publishYear2')?.disabled"
          class="clear-button"
          mat-mini-fab
          (click)="clearField('publishYear2')"
        >
          <mat-icon>delete</mat-icon>
        </button>
        <mat-hint> Year published to </mat-hint>
      </mat-form-field>
    </p>
    <p>
      <mat-form-field appearance="outline">
        <mat-label>Language</mat-label>
        <input formControlName="language" matInput placeholder="eng" />
        <button
          matSuffix
          type="button"
          class="clear-button"
          mat-mini-fab
          (click)="clearField('language')"
        >
          <mat-icon>delete</mat-icon>
        </button>
        <mat-hint
          >enter the first three letters of the language; japan uses jpn; mul
          for multiple
        </mat-hint>
      </mat-form-field>
    </p>
    <p>
      <mat-form-field appearance="outline">
        <mat-label>Subject</mat-label>
        <input formControlName="subject" matInput placeholder="fantasy" />
        <button
          matSuffix
          type="button"
          class="clear-button"
          mat-mini-fab
          (click)="clearField('subject')"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </mat-form-field>
    </p>
    <p>
      <mat-form-field appearance="outline">
        <mat-label>Publisher</mat-label>
        <input formControlName="publisher" matInput placeholder="Malmberg" />
        <button
          matSuffix
          type="button"
          class="clear-button"
          mat-mini-fab
          (click)="clearField('publisher')"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </mat-form-field>
    </p>
    <p>
      <mat-form-field appearance="outline">
        <mat-label>Character</mat-label>
        <input formControlName="person" matInput placeholder="Harry Potter" />
        <button
          matSuffix
          type="button"
          class="clear-button"
          mat-mini-fab
          (click)="clearField('person')"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </mat-form-field>
    </p>
  </div>

  <div
    style="width: fit-content"
    matTooltip="Filled fields need to be valid."
    [matTooltipDisabled]="!isSearchButtonDisabled()"
  >
    <button type="submit" mat-flat-button [disabled]="isSearchButtonDisabled()">
      Search
    </button>
  </div>
</form>

<div #listContainer>
  <h1>Books</h1>
  @if (books(); as books) {
  <ul class="book-list">
    @for (book of books.docs; track book.key) {
    <li>
      @if (!isLoading()) {
      <bf-book-list-item [book]="book"></bf-book-list-item>
      } @else {
      <bf-book-skeleton></bf-book-skeleton>
      }
    </li>
    } @empty {
    <li>No books available.</li>
    }
  </ul>
  @if (totalPages(); as totalPages;) {
  <div style="width: 100%; display: flex; justify-content: center">
    <mat-paginator
      #paginator
      class="demo-paginator"
      (page)="handlePageEvent($event)"
      [length]="books.numFound"
      [pageSize]="limit"
      [showFirstLastButtons]="true"
      [pageSizeOptions]="pageSizeOptions"
      [pageIndex]="page() - 1"
      aria-label="Select page"
    >
    </mat-paginator>
  </div>
  } } @else {
  <div class="loader">
    <mat-spinner></mat-spinner>
  </div>
  }
</div>
